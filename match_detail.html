{% extends "base.html" %}
{% set title = "比赛详情" %}

{% block content %}
<div class="mb-3">
  <a class="text-decoration-none" href="/matches">← 返回列表</a>
</div>

<div class="card shadow-sm p-4">
  <div class="d-flex justify-content-between flex-wrap gap-2">
    <div>
      <div class="muted">联赛</div>
      {% if match.league %}
        <a href="/league/{{ match.league|urlencode }}" class="text-decoration-none">
          <h4 class="mb-0">{{ match.league }}</h4>
        </a>
      {% else %}
        <h4 class="mb-0">-</h4>
      {% endif %}
      <div class="muted mt-1">开赛时间：{{ match.start_time or "-" }}</div>
    </div>

    <div class="text-end">
      <div class="muted">状态</div>
      <div class="badge text-bg-light">{{ match.status or "-" }}</div>
      <div class="muted mt-2">BO：{{ match.bo or "-" }}</div>
    </div>
  </div>

  <hr class="my-4">

  {% set opponents = (raw.get("opponents") or []) %}
  {% set league_obj = raw.get("league") or {} %}
  {% set teamA = opponents[0].get("opponent") if opponents|length > 0 else {} %}
  {% set teamB = opponents[1].get("opponent") if opponents|length > 1 else {} %}

  <div class="row align-items-center text-center">
    <div class="col-md-5">
      <div class="d-flex align-items-center justify-content-center gap-2">
        {% if teamA and teamA.get("image_url") %}
          <img class="team-logo" src="{{ teamA.get('image_url') }}" alt="A">
        {% else %}
          <div class="team-logo d-flex align-items-center justify-content-center border">?</div>
        {% endif %}
        <div class="fs-4 fw-semibold">{{ match.team_a or "TBD" }}</div>
      </div>
    </div>

    <div class="col-md-2 my-3 my-md-0">
      <div class="display-6 score">
        {{ (match.score_a if match.score_a is not none else "-") }}
        <span class="muted">:</span>
        {{ (match.score_b if match.score_b is not none else "-") }}
      </div>
    </div>

    <div class="col-md-5">
      <div class="d-flex align-items-center justify-content-center gap-2">
        <div class="fs-4 fw-semibold">{{ match.team_b or "TBD" }}</div>
        {% if teamB and teamB.get("image_url") %}
          <img class="team-logo" src="{{ teamB.get('image_url') }}" alt="B">
        {% else %}
          <div class="team-logo d-flex align-items-center justify-content-center border">?</div>
        {% endif %}
      </div>
    </div>
  </div>

  {% if league_obj.get("image_url") %}
    <div class="mt-4 text-center">
      <img src="{{ league_obj.get('image_url') }}" alt="league" style="max-height:60px; object-fit:contain;">
    </div>
  {% endif %}

  <details class="mt-4">
    <summary class="muted">查看原始数据（raw_json）</summary>
    <pre class="mt-2 p-3 bg-light border rounded small" style="white-space: pre-wrap;">{{ raw | tojson(indent=2) }}</pre>
  </details>
</div>
{% endblock %}
